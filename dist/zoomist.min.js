/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-11-08T16:09:34.266Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";var t={fill:"cover",src:"data-zoomist-src",draggable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1,wheel:!0};const e={direction:"horizontal",maxRatio:2},i="zoomist",o="zoomist-slider",n=!(!("undefined"!=typeof window&&void 0!==window.document)||!window.document.documentElement)&&"ontouchstart"in window.document.documentElement,a=n?"touchstart":"mousedown",s=n?"touchmove":"mousemove",r=n?"touchend touchcancel":"mouseup",d=(t,e)=>{t||(t={});for(const[i,o]of Object.entries(e))t[i]=o},l=t=>Object.assign({},t),h=t=>"number"==typeof t&&!isNaN(t),c=t=>null!==m(t),m=t=>t instanceof HTMLElement?t:document.querySelector(t),u=(t,e)=>{for(const[i,o]of Object.entries(e))t.style[i]=h(o)?`${o}px`:o},g=t=>({x:n?t.touches[0].pageX:t.pageX,y:n?t.touches[0].pageY:t.pageY,clientX:n?t.touches[0].clientX:t.clientX,clientY:n?t.touches[0].clientY:t.clientY}),p=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},f=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},w=t=>+(Math.round(t+"e+2")+"e-2"),b=(t,e,i)=>Math.min(Math.max(t,e),i);var v={getContainerData(){return l(this.data.containerData)},getImageData(){return l(this.data.imageData)},zoom(t,e){const{image:i,data:o,options:n,ratio:a}=this;if(n.bounds&&1===a&&t<0)return;if(n.maxRatio&&a===n.maxRatio&&t>0)return;const{originImageData:s}=o,r=this.getContainerData(),l=this.getImageData(),h=i.getBoundingClientRect(),c=w(a*(t+1)),m=n.bounds&&c<1?1:n.maxRatio&&c>n.maxRatio?n.maxRatio:c,g=m/a-1,v=s.width*m,x=s.height*m,y=(r.width-v)/2,z=(r.height-x)/2,R=e?(l.width/2-e.clientX+h.left)*g+p(i):p(i),Y=e?(l.height/2-e.clientY+h.top)*g+f(i):f(i),D=n.bounds?b(R,y,-y):R,E=n.bounds?b(Y,z,-z):Y,L={width:v,height:x,left:y,top:z};if(d(o.imageData,L),u(i,Object.assign({},L,{transform:`translate(${D}px, ${E}px)`})),this.ratio=m,n.slider){const{slider:t}=n,e=100*w(1-(t.maxRatio-m)/(t.maxRatio-1));this.slideTo(e)}return this},zoomTo(t){const{ratio:e}=this;if(t!==e){const i=t/e-1;this.zoom(i)}return this},slideTo(t){const{options:e}=this;if(!e.slider)return;const{slider:i}=e,o="horizontal"===i.direction?"left":"top",n=b(t,0,100);return i.sliderButton.style[o]=`${n}%`,this}};var x={createSlider(){const{options:t}=this;t.slider=Object.assign(e,t.slider);const{slider:i}=t;t.maxRatio&&Object.assign(t.slider,{maxRatio:t.maxRatio}),"horizontal"!==i.direction&&"vertical"!==i.direction&&(i.direction="horizontal"),this.mountSlider()},mountSlider(){const{options:t}=this,{slider:e}=t;if(e.mounted)return;const i=e.el&&c(e.el)?m(e.el):document.createElement("div");e.el&&c(e.el)||i.classList.add(o),i.innerHTML='\n  <div class="zoomist-slider-main">\n    <span class="zoomist-slider-bar"></span>\n    <span class="zoomist-slider-button"></span>\n  </div>\n',e.el=i,e.sliderMain=i.querySelector(".zoomist-slider-main"),e.sliderBar=i.querySelector(".zoomist-slider-bar"),e.sliderButton=i.querySelector(".zoomist-slider-button"),e.sliderMain.classList.add(`zoomist-slider-${e.direction}`),e.sliding=!1;const n="horizontal"===e.direction,d=t=>{const i=e.sliderMain.getBoundingClientRect(),o=n?g(t).clientX:g(t).clientY,a=n?i.width:i.height,s=n?i.left:i.top,r=b(w((o-s)/a),0,1),d=(e.maxRatio-1)*r+1;this.zoomTo(d)},l=t=>{e.sliding&&d(t)},h=t=>{e.sliding=!1,document.removeEventListener(s,l),document.removeEventListener(r,h)};e.sliderMain.addEventListener(a,(t=>{d(t),e.sliding=!0,document.addEventListener(s,l),document.addEventListener(r,h)})),e.mounted=!0,this.renderSlider()},renderSlider(){const{element:t,options:e}=this;t.append(e.slider.el)}};class y{constructor(e,i={}){if(!e)throw new Error("The first argument is required.");if(!c(e))throw new Error("This element is not exist.");this.element=m(e),this.options=Object.assign({},t,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:o}=Object.prototype;return e&&i&&o.call(i,"isPrototypeOf")}catch(t){return!1}})(i)&&i),this.init()}init(){const{element:e,options:o}=this;if(e[i])return;e[i]=this;const n=o.src="string"==typeof(a=o.src)&&""!==a?o.src:t.src;var a;const s=e.getAttribute(n);e.removeAttribute(n),this.create(s)}create(t){if(!t)return;const{element:e}=this,{offsetWidth:i,offsetHeight:o}=e;this.url=t,this.data={},this.data.containerData={width:i,height:o,aspectRatio:i/o},this.ratio=1,this.mount()}mount(){if(this.mounted)return;const{options:t,data:e,url:i}=this,{containerData:o}=e,{fill:n,maxRatio:l}=t;this.wrapper&&this.wrapper.remove();const c=document.createElement("div");c.classList.add("zoomist-wrapper");const m=document.createElement("img");m.classList.add("zoomist-image"),m.src=i,m.onload=()=>{this.wrapper=c,this.image=m;const{naturalWidth:e,naturalHeight:i}=m,w=e/i;let b;"cover"!==n&&"contain"!==n&&"none"!==n&&(t.fill="cover"),"cover"===t.fill&&(b=o.aspectRatio===w?"both":o.aspectRatio>w?"width":"height"),"contain"===t.fill&&(b=o.aspectRatio===w?"both":o.aspectRatio>w?"height":"width");const v="none"===t.fill?e:"both"===b||"width"===b?o.width:o.height*w,x="none"===t.fill?i:"both"===b||"height"===b?o.height:o.width/w,y=(o.width-v)/2,z=(o.height-x)/2;this.data.originImageData={naturalWidth:e,naturalHeight:i,aspectRatio:w,width:v,height:x,left:y,top:z},this.data.imageData=Object.assign({},this.data.originImageData),u(m,{width:v,height:x,left:y,top:z}),(!h(l)||l<=1)&&!1!==l&&(t.maxRatio=!1),(t=>{const{element:e,wrapper:i,image:o,options:n,data:l}=t,{containerData:h,imageData:c,originImageData:m}=l;window.addEventListener("resize",(()=>{const i=e.offsetWidth/h.width,n=e.offsetHeight/h.height,a=m.width*i,s=m.height*n,r=m.left*i,l=m.top*n,g=c.width*i,w=c.height*n,b=c.left*i,v=c.top*n,x=p(o)*i,y=f(o)*n;d(h,{width:e.offsetWidth,height:e.offsetHeight}),d(m,{width:a,height:s,left:r,top:l}),d(c,{width:g,height:w,left:b,top:v}),u(t.image,{width:g,height:w,left:b,top:v,transform:`translate(${x}px, ${y}px)`})})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===n.fill&&n.bounds&&(n.bounds=!1);const{dragData:w}=l,b=e=>{if(!t.dragging)return;const i=g(e).x,a=g(e).y;if(n.bounds){const t=w.startX-(w.transX-c.left),e=w.startX-(w.transX+c.left),o=w.startY-(w.transY-c.top),n=w.startY-(w.transY+c.top);i<t&&(w.startX+=i-t),i>e&&(w.startX+=i-e),a<o&&(w.startY+=a-o),a>n&&(w.startY+=a-n)}const s=i-w.startX+w.transX,r=a-w.startY+w.transY;o.style.transform=`translate(${s}px, ${r}px)`},v=()=>{t.dragging=!1,document.removeEventListener(s,b),document.removeEventListener(r,v)};i.addEventListener(a,(e=>{n.draggable&&1===e.which&&(d(w,{startX:g(e).x,startY:g(e).y,transX:p(o),transY:f(o)}),t.dragging=!0,document.addEventListener(s,b),document.addEventListener(r,v))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{const{zoomRatio:i}=n;if(t.wheeling)return;let o;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?o=e.deltaY>0?-1:1:e.wheelDelta?o=e.wheelDelta/120:e.detail&&(o=e.detail>0?-1:1),t.zoom(o*i,g(e))}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,wrapper:e,image:i,options:o}=this;t.classList.add("zoomist-container"),e.append(i),t.append(e),o.slider&&this.createSlider()}}return Object.assign(y.prototype,v,x),y}));
