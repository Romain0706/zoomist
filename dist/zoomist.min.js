/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-11-11T15:23:34.942Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";const t="zoomist",e=["slider","zoomer"],i="zoomist-slider",o="zoomist-in-zoomer",s="zoomist-out-zoomer",a="zoomist-zoomer-disable",n=!(!("undefined"!=typeof window&&void 0!==window.document)||!window.document.documentElement)&&"ontouchstart"in window.document.documentElement,r=n?"touchstart":"mousedown",d=n?"touchmove":"mousemove",l=n?"touchend touchcancel":"mouseup";var c={fill:"cover",src:"data-zoomist-src",draggable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1,wheel:!0};const h={el:i,direction:"horizontal",maxRatio:2},m={inEl:o,outEl:s,disableOnBounds:!0},u=(t,e)=>{t||(t={});for(const[i,o]of Object.entries(e))t[i]=o},p=t=>Object.assign({},t),g=t=>"number"==typeof t&&!isNaN(t),f=t=>null!==w(t),w=t=>t instanceof HTMLElement?t:document.querySelector(t),z=(t,e)=>{for(const[i,o]of Object.entries(e))t.style[i]=g(o)?`${o}px`:o},v=t=>({x:n?t.touches[0].pageX:t.pageX,y:n?t.touches[0].pageY:t.pageY,clientX:n?t.touches[0].clientX:t.clientX,clientY:n?t.touches[0].clientY:t.clientY}),b=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},E=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},x=t=>+(Math.round(t+"e+2")+"e-2"),L=(t,e,i)=>Math.min(Math.max(t,e),i);var R={getContainerData(){return p(this.data.containerData)},getImageData(){return p(this.data.imageData)},getSliderValue(){return this.options.slider.value},zoom(t,e){const{image:i,data:o,options:s,ratio:n}=this;if(s.bounds&&1===n&&t<0)return;if(s.maxRatio&&n===s.maxRatio&&t>0)return;const{originImageData:r}=o,d=this.getContainerData(),l=this.getImageData(),c=i.getBoundingClientRect(),h=x(n*(t+1)),m=s.bounds&&h<1?1:s.maxRatio&&h>s.maxRatio?s.maxRatio:h,p=m/n-1,g=r.width*m,f=r.height*m,w=(d.width-g)/2,v=(d.height-f)/2,R=e?(l.width/2-e.clientX+c.left)*p+b(i):b(i),y=e?(l.height/2-e.clientY+c.top)*p+E(i):E(i),Y=s.bounds?L(R,w,-w):R,D=s.bounds?L(y,v,-v):y,O={width:g,height:f,left:w,top:v};if(u(o.imageData,O),z(i,Object.assign({},O,{transform:`translate(${Y}px, ${D}px)`})),this.ratio=m,s.slider){const{slider:t}=s,e=100*x(1-(t.maxRatio-m)/(t.maxRatio-1));t.value=e,this.slideTo(e)}if(s.zoomer.disableOnBounds){const{zoomer:t,bounds:e,maxRatio:i}=s,{zoomerInEl:o,zoomerOutEl:n}=t;e&&1===this.ratio?n.classList.add(a):n.classList.remove(a),this.ratio===i?o.classList.add(a):o.classList.remove(a)}return this},zoomTo(t){const{ratio:e}=this;if(t!==e){const i=t/e-1;this.zoom(i)}return this},slideTo(t){const{options:e}=this;if(!e.slider)return;const{slider:i}=e,o="horizontal"===i.direction?"left":"top",s=L(t,0,100);return i.sliderButton.style[o]=`${s}%`,this}};var y={createModules(){const{options:t}=this;e.forEach((e=>{var i;t[e]&&this[`create${i=e,i.charAt(0).toUpperCase()+i.slice(1)}`]()}))},createSlider(){const{element:t,options:e}=this;e.slider=Object.assign(h,e.slider);const{slider:o}=e;e.maxRatio&&Object.assign(e.slider,{maxRatio:e.maxRatio}),"horizontal"!==o.direction&&"vertical"!==o.direction&&(o.direction="horizontal"),o.value=0,o.mounted&&o.sliderMain.remove();const s=o.el&&f(o.el),a=s?w(o.el):document.createElement("div");s||a.classList.add(i),a.innerHTML='\n  <div class="zoomist-slider-main">\n    <span class="zoomist-slider-bar"></span>\n    <span class="zoomist-slider-button"></span>\n  </div>\n',o.sliderEl=a,o.sliderMain=a.querySelector(".zoomist-slider-main"),o.sliderBar=a.querySelector(".zoomist-slider-bar"),o.sliderButton=a.querySelector(".zoomist-slider-button"),o.sliderMain.classList.add(`zoomist-slider-${o.direction}`),(t=>{const{slider:e}=t.options;e.sliding=!1;const i="horizontal"===e.direction,o=o=>{const s=e.sliderMain.getBoundingClientRect(),a=i?v(o).clientX:v(o).clientY,n=i?s.width:s.height,r=i?s.left:s.top,d=L(x((a-r)/n),0,1),l=t.ratio<1?t.ratio:1,c=((t.ratio>e.maxRatio?t.ratio:e.maxRatio)-l)*d+l;t.zoomTo(c)},s=t=>{e.sliding&&o(t)},a=t=>{e.sliding=!1,document.removeEventListener(d,s),document.removeEventListener(l,a)};e.sliderMain.addEventListener(r,(t=>{o(t),e.sliding=!0,document.addEventListener(d,s),document.addEventListener(l,a)}))})(this),o.mounted=!0,s||t.append(a)},createZoomer(){const{element:t,options:e}=this;e.zoomer=Object.assign(m,e.zoomer);const{zoomer:i}=e;i.mounted&&i.zoomerEl&&i.sliderMain.remove();const n=i.inEl&&f(i.inEl),r=i.outEl&&f(i.outEl),d=n?w(i.inEl):document.createElement("div"),l=r?w(i.outEl):document.createElement("div");if(n||d.classList.add(o),r||l.classList.add(s),i.zoomerInEl=d,i.zoomerOutEl=l,i.disableOnBounds){const{bounds:t,maxRatio:i}=e;t&&1===this.ratio&&l.classList.add(a),this.ratio===i&&d.classList.add(a)}if((t=>{const{options:e}=t,{zoomer:i,zoomRatio:o,bounds:s,maxRatio:a}=e;i.zoomerInEl.addEventListener("click",(()=>{t.zoom(o)})),i.zoomerOutEl.addEventListener("click",(()=>{t.zoom(-o)}))})(this),i.mounted=!0,!n||!r){const e=document.createElement("div");e.classList.add("zoomist-zoomer"),n||e.append(d),r||e.append(l),i.zoomerEl=e,t.append(e)}}};class Y{constructor(t,e={}){if(!t)throw new Error("The first argument is required.");if(!f(t))throw new Error("This element is not exist.");this.element=w(t),this.options=Object.assign({},c,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:o}=Object.prototype;return e&&i&&o.call(i,"isPrototypeOf")}catch(t){return!1}})(e)&&e),this.init()}init(){const{element:e,options:i}=this;if(e[t])return;e[t]=this;const o=i.src="string"==typeof(s=i.src)&&""!==s?i.src:c.src;var s;const a=e.getAttribute(o);e.removeAttribute(o),this.create(a)}create(t){if(!t)return;const{element:e}=this,{offsetWidth:i,offsetHeight:o}=e;this.url=t,this.data={},this.data.containerData={width:i,height:o,aspectRatio:i/o},this.ratio=1,this.mount()}mount(){if(this.mounted)return;const{options:t,data:e,url:i}=this,{containerData:o}=e,{fill:s,maxRatio:a}=t;this.wrapper&&this.wrapper.remove();const n=document.createElement("div");n.classList.add("zoomist-wrapper");const c=document.createElement("img");c.classList.add("zoomist-image"),c.src=i,c.onload=()=>{this.wrapper=n,this.image=c;const{naturalWidth:e,naturalHeight:i}=c,h=e/i;let m;"cover"!==s&&"contain"!==s&&"none"!==s&&(t.fill="cover"),"contain"!==t.fill&&(m=o.aspectRatio===h?"both":o.aspectRatio>h?"width":"height"),"contain"===t.fill&&(m=o.aspectRatio===h?"both":o.aspectRatio>h?"height":"width");const p="none"===t.fill?e:"both"===m||"width"===m?o.width:o.height*h,f="none"===t.fill?i:"both"===m||"height"===m?o.height:o.width/h,w=(o.width-p)/2,x=(o.height-f)/2;this.data.originImageData={naturalWidth:e,naturalHeight:i,aspectRatio:h,width:p,height:f,left:w,top:x},this.data.imageData=Object.assign({},this.data.originImageData),z(c,{width:p,height:f,left:w,top:x}),(!g(a)||a<=1)&&!1!==a&&(t.maxRatio=!1),(t=>{const{element:e,wrapper:i,image:o,options:s,data:a}=t,{containerData:n,imageData:c,originImageData:h}=a;window.addEventListener("resize",(()=>{const i=e.offsetWidth/n.width,s=e.offsetHeight/n.height,a=h.width*i,r=h.height*s,d=h.left*i,l=h.top*s,m=c.width*i,p=c.height*s,g=c.left*i,f=c.top*s,w=b(o)*i,v=E(o)*s;u(n,{width:e.offsetWidth,height:e.offsetHeight}),u(h,{width:a,height:r,left:d,top:l}),u(c,{width:m,height:p,left:g,top:f}),z(t.image,{width:m,height:p,left:g,top:f,transform:`translate(${w}px, ${v}px)`})})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===s.fill&&s.bounds&&(s.bounds=!1);const{dragData:m}=a,p=e=>{if(!t.dragging)return;const i=v(e).x,a=v(e).y;if(s.bounds){const t=m.startX-(m.transX-c.left),e=m.startX-(m.transX+c.left),o=m.startY-(m.transY-c.top),s=m.startY-(m.transY+c.top);i<t&&(m.startX+=i-t),i>e&&(m.startX+=i-e),a<o&&(m.startY+=a-o),a>s&&(m.startY+=a-s)}const n=i-m.startX+m.transX,r=a-m.startY+m.transY;o.style.transform=`translate(${n}px, ${r}px)`},g=()=>{t.dragging=!1,document.removeEventListener(d,p),document.removeEventListener(l,g)};i.addEventListener(r,(e=>{s.draggable&&1===e.which&&(u(m,{startX:v(e).x,startY:v(e).y,transX:b(o),transY:E(o)}),t.dragging=!0,document.addEventListener(d,p),document.addEventListener(l,g))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{if(!s.wheelable)return;const{zoomRatio:i}=s;if(t.wheeling)return;let o;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?o=e.deltaY>0?-1:1:e.wheelDelta?o=e.wheelDelta/120:e.detail&&(o=e.detail>0?-1:1),t.zoom(o*i,v(e))}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,wrapper:e,image:i,options:o}=this;t.classList.add("zoomist-container"),e.append(i),t.append(e),this.createModules()}}return Object.assign(Y.prototype,R,y),Y}));
