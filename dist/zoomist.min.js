/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-12-28T06:52:09.672Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";const t="zoomist",e=["slider","zoomer"],i="zoomist-container",o="zoomist-slider",s="zoomist-in-zoomer",n="zoomist-out-zoomer",r="zoomist-zoomer-disable",a=!(!("undefined"!=typeof window&&void 0!==window.document)||!("ontouchstart"in window)),l=a?"touchstart":"mousedown",d=a?"touchmove":"mousemove",m=a?"touchend":"mouseup";var h={fill:"cover",src:"data-zoomist-src",draggable:!0,wheelable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1,height:"auto"};const c={el:o,direction:"horizontal",maxRatio:2},u={inEl:s,outEl:n,disableOnBounds:!0},g={ready:null,zoom:null,wheel:null,dragStart:null,drag:null,dragEnd:null,slideStart:null,slide:null,slideEnd:null,resize:null,reset:null,destroy:null,update:null},p=(t,e)=>{t||(t={});for(const[i,o]of Object.entries(e))t[i]=o},f=t=>Object.assign({},t),v=t=>"number"==typeof t&&!isNaN(t),w=t=>null!==z(t),z=t=>t instanceof HTMLElement?t:document.querySelector(t),_=t=>w(t)&&"IMG"===z(t).tagName,E=t=>"function"==typeof t,x=(t,e)=>{for(const[i,o]of Object.entries(e))t.style[i]=v(o)?`${o}px`:o},y=t=>{const e=!a||"wheel"===t.type;return{x:e?t.pageX:t.touches[0].pageX,y:e?t.pageY:t.touches[0].pageY,clientX:e?t.clientX:t.touches[0].clientX,clientY:e?t.clientY:t.touches[0].clientY}},b=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},L=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},R=t=>+(Math.round(t+"e+2")+"e-2"),O=(t,e,i)=>Math.min(Math.max(t,e),i);var Y={getContainerData(){return f(this.data.containerData)},getImageData(){return f(this.data.imageData)},getSliderValue(){return this.__modules__.slider?.value},getZoomRatio(){return this.ratio},zoom(t,e){const{image:i,data:o,options:s,ratio:n}=this;if(s.bounds&&1===n&&t<0)return;if(s.maxRatio&&n===s.maxRatio&&t>0)return;const{originImageData:a}=o,l=this.getContainerData(),d=this.getImageData(),m=i.getBoundingClientRect(),h=R(n*(t+1)),c=s.bounds&&h<1?1:s.maxRatio&&h>s.maxRatio?s.maxRatio:h,u=c/n-1,g=a.width*c,f=a.height*c,v=(l.width-g)/2,w=(l.height-f)/2,z=e?(d.width/2-e.clientX+m.left)*u+b(i):b(i),_=e?(d.height/2-e.clientY+m.top)*u+L(i):L(i),E=s.bounds?O(z,v,-v):z,y=s.bounds?O(_,w,-w):_,Y={width:g,height:f,left:v,top:w};if(p(o.imageData,Y),x(i,{...Y,transform:`translate(${E}px, ${y}px)`}),this.ratio=c,this.emit("zoom",c),s.slider){const{slider:t}=this.__modules__,e=100*R(1-(t.maxRatio-c)/(t.maxRatio-1));t.value=O(e,0,100),this.slideTo(e,!0)}if(s.zoomer){const{zoomer:t}=this.__modules__;if(t.disableOnBounds){const{bounds:t,maxRatio:e}=s,{zoomerInEl:i,zoomerOutEl:o}=this.__modules__.zoomer;t&&1===this.ratio?o.classList.add(r):o.classList.remove(r),this.ratio===e?i.classList.add(r):i.classList.remove(r)}}return this},zoomTo(t){const{ratio:e}=this;if(t!==e){const i=t/e-1;this.zoom(i)}return this},slideTo(t,e){const{__modules__:i}=this;if(!i.slider)return;const{slider:o}=i,s="horizontal"===o.direction?"left":"top",n="horizontal"===o.direction?"":"-",r=O(t,0,100);if(o.sliderButton.style[s]=`${n}${r}%`,!e){const t=r/100,e=this.ratio<1?this.ratio:1,i=((this.ratio>o.maxRatio?this.ratio:o.maxRatio)-e)*t+e;this.zoomTo(i)}return this},reset(){const{image:t}=this;return this.zoomTo(1),x(t,{transform:"translate(0, 0)"}),this.emit("reset"),this},destroy(){const{element:e,wrapper:o}=this,{slider:s,zoomer:n}=this.__modules__;return e[t]=void 0,this.mounted=!1,s&&this.destroySlider(),n&&this.destroyZoomer(),o.remove(),e.style.removeProperty("width"),e.style.removeProperty("padding-bottom"),e.classList.remove(i),this.emit("destroy"),this},update(){return this.destroy().init(),this.emit("update"),this},on(t,e){if(!E(e))return this;const{__events__:i}=this;return t.split(" ").forEach((t=>{i[t]||(i[t]=[]),i[t].push(e)})),this},emit(...t){const{__events__:e}=this,i=t[0],o=t.slice(1,t.length);return e[i]?(e[i].forEach((t=>{E(t)&&t.apply(this,o)})),this):this}};var D={createModules(){const{options:t}=this;this.__modules__={},e.forEach((e=>{var i;t[e]&&this[`create${i=e,i.charAt(0).toUpperCase()+i.slice(1)}`]()}))},createSlider(){const{element:t,options:e,__modules__:i}=this;i.slider=Object.assign({},c,e.slider);const{slider:s}=i;e.maxRatio&&Object.assign(s,{maxRatio:e.maxRatio}),"horizontal"!==s.direction&&"vertical"!==s.direction&&(s.direction="horizontal"),s.value=0,s.mounted&&s.sliderMain.remove();const n=s.isCustomEl=s.el&&w(s.el),r=n?z(s.el):document.createElement("div");n||r.classList.add(o),r.innerHTML='\n  <div class="zoomist-slider-main">\n    <span class="zoomist-slider-bar"></span>\n    <span class="zoomist-slider-button"></span>\n  </div>\n',s.sliderEl=r,s.sliderMain=r.querySelector(".zoomist-slider-main"),s.sliderBar=r.querySelector(".zoomist-slider-bar"),s.sliderButton=r.querySelector(".zoomist-slider-button"),s.sliderMain.classList.add(`zoomist-slider-${s.direction}`),(t=>{const{slider:e}=t.__modules__;e.sliding=!1;const i="horizontal"===e.direction,o=o=>{const s=e.sliderMain.getBoundingClientRect(),n=i?y(o).clientX:-y(o).clientY,r=i?s.width:s.height,a=i?s.left:-s.bottom,l=O(R((n-a)/r),0,1),d=t.ratio<1?t.ratio:1,m=((t.ratio>e.maxRatio?t.ratio:e.maxRatio)-d)*l+d;t.zoomTo(m)},s=i=>{o(i),e.sliding=!0,t.emit("slideStart",t.getSliderValue(),i),document.addEventListener(d,n),document.addEventListener(m,r)},n=i=>{e.sliding&&(o(i),t.emit("slide",t.getSliderValue(),i))},r=i=>{e.sliding=!1,t.emit("slideEnd",t.getSliderValue(),i),document.removeEventListener(d,n),document.removeEventListener(m,r)};e.sliderMain.addEventListener(l,s),e.sliderMain.event=s})(this),s.mounted=!0,n||t.append(r)},destroySlider(){const{slider:t}=this.__modules__;t&&t.mounted&&(t.isCustomEl?t.sliderMain.remove():t.sliderEl.remove(),t.mounted=!1)},createZoomer(){const{element:t,options:e,__modules__:i}=this;i.zoomer=Object.assign({},u,e.zoomer);const{zoomer:o}=i;o.mounted&&o.zoomerEl&&o.sliderMain.remove();const a=o.isCustomInEl=o.inEl&&w(o.inEl),l=o.isCustomOutEl=o.outEl&&w(o.outEl),d=a?z(o.inEl):document.createElement("div"),m=l?z(o.outEl):document.createElement("div");if(a||(d.classList.add(s),d.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 12 12">\n  <polygon points="12,5.5 6.5,5.5 6.5,0 5.5,0 5.5,5.5 0,5.5 0,6.5 5.5,6.5 5.5,12 6.5,12 6.5,6.5 12,6.5 "/>\n</svg>\n'),l||(m.classList.add(n),m.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 12 12">\n  <rect y="5.5" width="12" height="1"/>\n</svg>\n'),o.zoomerInEl=d,o.zoomerOutEl=m,o.disableOnBounds){const{bounds:t,maxRatio:i}=e;t&&1===this.ratio&&m.classList.add(r),this.ratio===i&&d.classList.add(r)}if((t=>{const{zoomRatio:e}=t.options,{zoomer:i}=t.__modules__,o=()=>t.zoom(e),s=()=>t.zoom(-e);i.zoomerInEl.addEventListener("click",o),i.zoomerOutEl.addEventListener("click",s),i.zoomerInEl.event=o,i.zoomerOutEl.event=s})(this),o.mounted=!0,!a||!l){const e=document.createElement("div");e.classList.add("zoomist-zoomer"),a||e.append(d),l||e.append(m),o.zoomerEl=e,t.append(e)}},destroyZoomer(){const{zoomer:t}=this.__modules__;if(!t||!t.mounted)return;const e=t=>{t.removeEventListener("click",t.event),t.event=void 0,t.classList.remove(r)};t.isCustomInEl?e(t.zoomerInEl):t.zoomerInEl.remove(),t.isCustomOutEl?e(t.zoomerOutEl):t.zoomerOutEl.remove(),t.zoomerEl&&t.zoomerEl.remove(),t.mounted=!1}};class X{constructor(t,e={}){if(!t)throw new Error("The first argument is required.");if(!w(t))throw new Error("This element is not exist.");this.element=z(t),this.options=Object.assign({},h,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:o}=Object.prototype;return e&&i&&o.call(i,"isPrototypeOf")}catch(t){return!1}})(e)&&e),this.init()}init(){const{element:e,options:i}=this,{src:o}=i;if(e[t])return;e[t]=this;const s=i.src="string"==typeof(n=o)&&""!==n||_(o)?o:h.src;var n;const r=_(s)?s.src:e.getAttribute(s);if(!r)throw new Error(`Cannot find src from ${s}`);this.create(r)}create(t){if(!t)return;const{options:e}=this;if(this.url=t,this.data={},this.ratio=1,this.__events__=g,e.on)for(const[t,i]of Object.entries(e.on))this.__events__[t]=[i];this.mount()}mount(){if(this.mounted)return;const{element:t,options:e,data:i,url:o}=this,{fill:s,maxRatio:n,height:r}=e;this.wrapper&&this.wrapper.remove();const a=document.createElement("div");a.classList.add("zoomist-wrapper");const h=document.createElement("img");h.classList.add("zoomist-image"),h.src=o,h.onload=()=>{this.wrapper=a,this.image=h;const{naturalWidth:o,naturalHeight:c}=h,u=o/c;r&&(x(t,{width:"100%"}),"auto"===r?x(t,{paddingBottom:`${R(c/o*100)}%`}):v(r)?x(t,{height:r}):r.indexOf("%")>-1&&x(t,{paddingBottom:r}));const{offsetWidth:g,offsetHeight:f}=t;this.data.containerData={width:g,height:f,aspectRatio:g/f};const{containerData:w}=i;let z;"cover"!==s&&"contain"!==s&&"none"!==s&&(e.fill="cover"),"contain"!==e.fill&&(z=w.aspectRatio===u?"both":w.aspectRatio>u?"width":"height"),"contain"===e.fill&&(z=w.aspectRatio===u?"both":w.aspectRatio>u?"height":"width");const _="none"===e.fill?o:"both"===z||"width"===z?w.width:w.height*u,E="none"===e.fill?c:"both"===z||"height"===z?w.height:w.width/u,O=(w.width-_)/2,Y=(w.height-E)/2;this.data.originImageData={naturalWidth:o,naturalHeight:c,aspectRatio:u,width:_,height:E,left:O,top:Y},this.data.imageData=Object.assign({},this.data.originImageData),x(h,{width:_,height:E,left:O,top:Y}),(!v(n)||n<=1)&&!1!==n&&(e.maxRatio=!1),(t=>{const{element:e,wrapper:i,image:o,options:s,data:n}=t,{containerData:r,imageData:a,originImageData:h}=n;window.addEventListener("resize",(()=>{if(r.width===e.offsetWidth)return;const i=e.offsetWidth/r.width,s=e.offsetHeight/r.height,n=h.width*i,l=h.height*s,d=h.left*i,m=h.top*s,c=a.width*i,u=a.height*s,g=a.left*i,f=a.top*s,v=b(o)*i,w=L(o)*s;p(r,{width:e.offsetWidth,height:e.offsetHeight}),p(h,{width:n,height:l,left:d,top:m}),p(a,{width:c,height:u,left:g,top:f}),x(t.image,{width:c,height:u,left:g,top:f,transform:`translate(${v}px, ${w}px)`}),t.emit("resize")})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===s.fill&&s.bounds&&(s.bounds=!1);const{dragData:c}=n,u=e=>{if(!t.dragging)return;const i=y(e).x,n=y(e).y;if(s.bounds){const t=c.startX-(c.transX-a.left),e=c.startX-(c.transX+a.left),o=c.startY-(c.transY-a.top),s=c.startY-(c.transY+a.top);i<t&&(c.startX+=i-t),i>e&&(c.startX+=i-e),n<o&&(c.startY+=n-o),n>s&&(c.startY+=n-s)}const r=R(i-c.startX+c.transX),l=R(n-c.startY+c.transY);o.style.transform=`translate(${r}px, ${l}px)`,t.emit("drag",{x:r,y:l},e)},g=e=>{t.dragging=!1,t.emit("dragEnd",{x:b(o),y:L(o)},e),document.removeEventListener(d,u),document.removeEventListener(m,g)};i.addEventListener(l,(e=>{s.draggable&&2!==e.which&&3!==e.which&&(p(c,{startX:y(e).x,startY:y(e).y,transX:b(o),transY:L(o)}),t.dragging=!0,t.emit("dragStart",{x:c.transX,y:c.transY},e),document.addEventListener(d,u),document.addEventListener(m,g))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{if(!s.wheelable)return;e.preventDefault();const{zoomRatio:i}=s;if(t.wheeling)return;let o;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?o=e.deltaY>0?-1:1:e.wheelDelta?o=e.wheelDelta/120:e.detail&&(o=e.detail>0?-1:1),t.zoom(o*i,y(e)),t.emit("wheel",e)}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,wrapper:e,image:o}=this;t.classList.add(i),e.append(o),t.append(e),this.createModules(),this.emit("ready")}}return Object.assign(X.prototype,Y,D),X}));
