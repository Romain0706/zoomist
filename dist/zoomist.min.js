/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-11-09T15:29:38.387Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";var t={fill:"cover",src:"data-zoomist-src",draggable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1,wheel:!0};const e={direction:"horizontal",maxRatio:2},i={},o="zoomist",n=["slider","zoomer"],a="zoomist-slider",s=!(!("undefined"!=typeof window&&void 0!==window.document)||!window.document.documentElement)&&"ontouchstart"in window.document.documentElement,r=s?"touchstart":"mousedown",d=s?"touchmove":"mousemove",l=s?"touchend touchcancel":"mouseup",c=(t,e)=>{t||(t={});for(const[i,o]of Object.entries(e))t[i]=o},h=t=>Object.assign({},t),m=t=>"number"==typeof t&&!isNaN(t),u=t=>null!==g(t),g=t=>t instanceof HTMLElement?t:document.querySelector(t),p=(t,e)=>{for(const[i,o]of Object.entries(e))t.style[i]=m(o)?`${o}px`:o},f=t=>({x:s?t.touches[0].pageX:t.pageX,y:s?t.touches[0].pageY:t.pageY,clientX:s?t.touches[0].clientX:t.clientX,clientY:s?t.touches[0].clientY:t.clientY}),w=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},z=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},v=t=>+(Math.round(t+"e+2")+"e-2"),E=(t,e,i)=>Math.min(Math.max(t,e),i);var b={getContainerData(){return h(this.data.containerData)},getImageData(){return h(this.data.imageData)},zoom(t,e){const{image:i,data:o,options:n,ratio:a}=this;if(n.bounds&&1===a&&t<0)return;if(n.maxRatio&&a===n.maxRatio&&t>0)return;const{originImageData:s}=o,r=this.getContainerData(),d=this.getImageData(),l=i.getBoundingClientRect(),h=v(a*(t+1)),m=n.bounds&&h<1?1:n.maxRatio&&h>n.maxRatio?n.maxRatio:h,u=m/a-1,g=s.width*m,f=s.height*m,b=(r.width-g)/2,x=(r.height-f)/2,R=e?(d.width/2-e.clientX+l.left)*u+w(i):w(i),y=e?(d.height/2-e.clientY+l.top)*u+z(i):z(i),L=n.bounds?E(R,b,-b):R,Y=n.bounds?E(y,x,-x):y,D={width:g,height:f,left:b,top:x};if(c(o.imageData,D),p(i,Object.assign({},D,{transform:`translate(${L}px, ${Y}px)`})),this.ratio=m,n.slider){const{slider:t}=n,e=100*v(1-(t.maxRatio-m)/(t.maxRatio-1));this.slideTo(e)}return this},zoomTo(t){const{ratio:e}=this;if(t!==e){const i=t/e-1;this.zoom(i)}return this},slideTo(t){const{options:e}=this;if(!e.slider)return;const{slider:i}=e,o="horizontal"===i.direction?"left":"top",n=E(t,0,100);return i.sliderButton.style[o]=`${n}%`,this}};var x={createModules(){const{options:t}=this;n.forEach((e=>{var i;t[e]&&this[`create${i=e,i.charAt(0).toUpperCase()+i.slice(1)}`]()}))},createSlider(){const{element:t,options:i}=this;i.slider=Object.assign(e,i.slider);const{slider:o}=i;i.maxRatio&&Object.assign(i.slider,{maxRatio:i.maxRatio}),"horizontal"!==o.direction&&"vertical"!==o.direction&&(o.direction="horizontal"),o.mounted&&o.sliderMain.remove();const n=o.el&&u(o.el),s=n?g(o.el):document.createElement("div");n||s.classList.add(a),s.innerHTML='\n  <div class="zoomist-slider-main">\n    <span class="zoomist-slider-bar"></span>\n    <span class="zoomist-slider-button"></span>\n  </div>\n',o.sliderEl=s,o.sliderMain=s.querySelector(".zoomist-slider-main"),o.sliderBar=s.querySelector(".zoomist-slider-bar"),o.sliderButton=s.querySelector(".zoomist-slider-button"),o.sliderMain.classList.add(`zoomist-slider-${o.direction}`),(t=>{const{slider:e}=t.options;e.sliding=!1;const i="horizontal"===e.direction,o=o=>{const n=e.sliderMain.getBoundingClientRect(),a=i?f(o).clientX:f(o).clientY,s=i?n.width:n.height,r=i?n.left:n.top,d=E(v((a-r)/s),0,1),l=(e.maxRatio-1)*d+1;t.zoomTo(l)},n=t=>{e.sliding&&o(t)},a=t=>{e.sliding=!1,document.removeEventListener(d,n),document.removeEventListener(l,a)};e.sliderMain.addEventListener(r,(t=>{o(t),e.sliding=!0,document.addEventListener(d,n),document.addEventListener(l,a)}))})(this),o.mounted=!0,n||t.append(s)},createZoomer(){const{element:t,options:e}=this;e.zoomer=Object.assign(i,e.zoomer);const{zoomer:o}=e;o.mounted&&o.zoomerEl&&o.sliderMain.remove();const n=o.inEl&&u(o.inEl),a=o.outEl&&u(o.outEl),s=n?g(o.inEl):document.createElement("div"),r=a?g(o.outEl):document.createElement("div");if(n||s.classList.add("zoomist-in-zoomer"),a||r.classList.add("zoomist-out-zoomer"),o.zoomerInEl=s,o.zoomerOutEl=r,(t=>{const{options:e}=t,{zoomer:i,zoomRatio:o,bounds:n,maxRatio:a}=e;i.zoomerInEl.addEventListener("click",(()=>{t.zoom(o),console.log(t.ratio,a)})),i.zoomerOutEl.addEventListener("click",(()=>{t.zoom(-o)}))})(this),o.mounted=!0,!n||!a){const e=document.createElement("div");e.classList.add("zoomist-zoomer"),n||e.append(s),a||e.append(r),o.zoomerEl=e,t.append(e)}}};class R{constructor(e,i={}){if(!e)throw new Error("The first argument is required.");if(!u(e))throw new Error("This element is not exist.");this.element=g(e),this.options=Object.assign({},t,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:o}=Object.prototype;return e&&i&&o.call(i,"isPrototypeOf")}catch(t){return!1}})(i)&&i),this.init()}init(){const{element:e,options:i}=this;if(e[o])return;e[o]=this;const n=i.src="string"==typeof(a=i.src)&&""!==a?i.src:t.src;var a;const s=e.getAttribute(n);e.removeAttribute(n),this.create(s)}create(t){if(!t)return;const{element:e}=this,{offsetWidth:i,offsetHeight:o}=e;this.url=t,this.data={},this.data.containerData={width:i,height:o,aspectRatio:i/o},this.ratio=1,this.mount()}mount(){if(this.mounted)return;const{options:t,data:e,url:i}=this,{containerData:o}=e,{fill:n,maxRatio:a}=t;this.wrapper&&this.wrapper.remove();const s=document.createElement("div");s.classList.add("zoomist-wrapper");const h=document.createElement("img");h.classList.add("zoomist-image"),h.src=i,h.onload=()=>{this.wrapper=s,this.image=h;const{naturalWidth:e,naturalHeight:i}=h,u=e/i;let g;"cover"!==n&&"contain"!==n&&"none"!==n&&(t.fill="cover"),"cover"===t.fill&&(g=o.aspectRatio===u?"both":o.aspectRatio>u?"width":"height"),"contain"===t.fill&&(g=o.aspectRatio===u?"both":o.aspectRatio>u?"height":"width");const v="none"===t.fill?e:"both"===g||"width"===g?o.width:o.height*u,E="none"===t.fill?i:"both"===g||"height"===g?o.height:o.width/u,b=(o.width-v)/2,x=(o.height-E)/2;this.data.originImageData={naturalWidth:e,naturalHeight:i,aspectRatio:u,width:v,height:E,left:b,top:x},this.data.imageData=Object.assign({},this.data.originImageData),p(h,{width:v,height:E,left:b,top:x}),(!m(a)||a<=1)&&!1!==a&&(t.maxRatio=!1),(t=>{const{element:e,wrapper:i,image:o,options:n,data:a}=t,{containerData:s,imageData:h,originImageData:m}=a;window.addEventListener("resize",(()=>{const i=e.offsetWidth/s.width,n=e.offsetHeight/s.height,a=m.width*i,r=m.height*n,d=m.left*i,l=m.top*n,u=h.width*i,g=h.height*n,f=h.left*i,v=h.top*n,E=w(o)*i,b=z(o)*n;c(s,{width:e.offsetWidth,height:e.offsetHeight}),c(m,{width:a,height:r,left:d,top:l}),c(h,{width:u,height:g,left:f,top:v}),p(t.image,{width:u,height:g,left:f,top:v,transform:`translate(${E}px, ${b}px)`})})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===n.fill&&n.bounds&&(n.bounds=!1);const{dragData:u}=a,g=e=>{if(!t.dragging)return;const i=f(e).x,a=f(e).y;if(n.bounds){const t=u.startX-(u.transX-h.left),e=u.startX-(u.transX+h.left),o=u.startY-(u.transY-h.top),n=u.startY-(u.transY+h.top);i<t&&(u.startX+=i-t),i>e&&(u.startX+=i-e),a<o&&(u.startY+=a-o),a>n&&(u.startY+=a-n)}const s=i-u.startX+u.transX,r=a-u.startY+u.transY;o.style.transform=`translate(${s}px, ${r}px)`},v=()=>{t.dragging=!1,document.removeEventListener(d,g),document.removeEventListener(l,v)};i.addEventListener(r,(e=>{n.draggable&&1===e.which&&(c(u,{startX:f(e).x,startY:f(e).y,transX:w(o),transY:z(o)}),t.dragging=!0,document.addEventListener(d,g),document.addEventListener(l,v))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{const{zoomRatio:i}=n;if(t.wheeling)return;let o;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?o=e.deltaY>0?-1:1:e.wheelDelta?o=e.wheelDelta/120:e.detail&&(o=e.detail>0?-1:1),t.zoom(o*i,f(e))}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,wrapper:e,image:i,options:o}=this;t.classList.add("zoomist-container"),e.append(i),t.append(e),this.createModules()}}return Object.assign(R.prototype,b,x),R}));
