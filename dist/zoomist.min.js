/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-11-06T10:00:44.282Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";var t={fill:"cover",src:"data-zoomist-src",wheelable:!0,draggable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1};const e="zoomist",i=!(!("undefined"!=typeof window&&void 0!==window.document)||!window.document.documentElement)&&"ontouchstart"in window.document.documentElement,a=i?"touchstart":"mousedown",o=i?"touchmove":"mousemove",n=i?"touchend touchcancel":"mouseup",s=(t,e)=>{t||(t={});for(const[i,a]of Object.entries(e))t[i]=a},r=t=>Object.assign({},t),h=t=>"number"==typeof t&&!isNaN(t),d=t=>t instanceof HTMLElement?t:document.querySelector(t),l=(t,e)=>{for(const[i,a]of Object.entries(e))t.style[i]=h(a)?`${a}px`:a},c=t=>({x:i?t.touches[0].pageX:t.pageX,y:i?t.touches[0].pageY:t.pageY,clientX:i?t.touches[0].clientX:t.clientX,clientY:i?t.touches[0].clientY:t.clientY}),g=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},m=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},f=(t,e,i)=>Math.min(Math.max(t,e),i);var u={getContainerData(){return r(this.data.containerData)},getImageData(){return r(this.data.imageData)},zoom(t,e){const{image:i,data:a,options:o}=this,{originImageData:n,maxImageData:r}=a,h=this.getContainerData(),d=this.getImageData(),c=i.getBoundingClientRect(),u=d.width*(t+1),p=d.height*(t+1),w=o.bounds&&u<=n.width,b=o.maxRatio&&u>=r.width,x=w?n.width:b?r.width:u,D=w?n.height:b?r.height:p,y=w?n.left:b?r.left:(h.width-u)/2,v=w?n.top:b?r.top:(h.height-p)/2,Y=e?(d.width/2-e.clientX+c.left)*t+g(i):0,X=e?(d.height/2-e.clientY+c.top)*t+m(i):0,E=o.bounds?f(Y,y,-y):Y,$=o.bounds?f(X,v,-v):X,j={width:x,height:D,left:y,top:v};s(a.imageData,j),l(i,Object.assign({},j,{transform:`translate(${E}px, ${$}px)`}))}};class p{constructor(e,i={}){if(!e)throw new Error("The first argument is required.");if(null===d(e))throw new Error("This element is not exist.");this.element=d(e),this.options=Object.assign({},t,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:a}=Object.prototype;return e&&i&&a.call(i,"isPrototypeOf")}catch(t){return!1}})(i)&&i),this.init()}init(){const{element:i,options:a}=this;if(i[e])return;i[e]=this;const o=a.src="string"==typeof(n=a.src)&&""!==n?a.src:t.src;var n;const s=i.getAttribute(o);i.removeAttribute(o),this.create(s)}create(t){if(!t)return;const{element:e}=this,{offsetWidth:i,offsetHeight:a}=e;this.url=t,this.data={},this.data.containerData={width:i,height:a,ratio:i/a},this.mount()}mount(){if(this.mounted)return;const{options:t,data:e,url:i}=this,{containerData:r}=e,{fill:d,maxRatio:f}=t;this.image&&this.image.remove();const u=document.createElement("img");u.classList.add("zoomist-image"),u.src=i,u.onload=()=>{this.image=u;const{naturalWidth:e,naturalHeight:i}=u,p=e/i;let w;"cover"!==d&&"contain"!==d&&"none"!==d&&(t.fill="cover"),"cover"===t.fill&&(w=r.ratio===p?"both":r.ratio>p?"width":"height"),"contain"===t.fill&&(w=r.ratio===p?"both":r.ratio>p?"height":"width");const b="none"===t.fill?e:"both"===w||"width"===w?r.width:r.height*p,x="none"===t.fill?i:"both"===w||"height"===w?r.height:r.width/p,D=(r.width-b)/2,y=(r.height-x)/2;if(this.data.originImageData={naturalWidth:e,naturalHeight:i,width:b,height:x,ratio:p,left:D,top:y},this.data.imageData=Object.assign({},this.data.originImageData),(!h(f)||f<=1)&&!1!==f&&(t.maxRatio=!1),t.maxRatio){const{maxRatio:e}=t;this.data.maxImageData={width:b*e,height:x*e,left:(r.width-b*e)/2,top:(r.height-x*e)/2}}l(u,{width:b,height:x,left:D,top:y}),(t=>{const{element:e,image:i,options:r,data:h}=t,{containerData:d,imageData:f,originImageData:u,maxImageData:p}=h;window.addEventListener("resize",(()=>{const a=e.offsetWidth/d.width,o=e.offsetHeight/d.height,n=u.width*a,r=u.height*o,h=u.left*a,c=u.top*o,w=f.width*a,b=f.height*o,x=f.left*a,D=f.top*o,y=g(i)*a,v=m(i)*o;if(s(d,{width:e.offsetWidth,height:e.offsetHeight}),s(u,{width:n,height:r,left:h,top:c}),s(f,{width:w,height:b,left:x,top:D}),l(t.image,{width:w,height:b,left:x,top:D,transform:`translate(${y}px, ${v}px)`}),p){const t=p.width*a,e=p.height*o,i=p.left*a,n=p.top*o;s(p,{width:t,height:e,left:i,top:n})}})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===r.fill&&r.bounds&&(r.bounds=!1);const{dragData:w}=h,b=e=>{if(!t.dragging)return;const a=c(e).x,o=c(e).y;if(r.bounds){const t=w.startX-(w.transX-f.left),e=w.startX-(w.transX+f.left),i=w.startY-(w.transY-f.top),n=w.startY-(w.transY+f.top);a<t&&(w.startX+=a-t),a>e&&(w.startX+=a-e),o<i&&(w.startY+=o-i),o>n&&(w.startY+=o-n)}const n=a-w.startX+w.transX,s=o-w.startY+w.transY;i.style.transform=`translate(${n}px, ${s}px)`},x=()=>{t.dragging=!1,document.removeEventListener(o,b),document.removeEventListener(n,x)};e.addEventListener(a,(e=>{r.draggable&&(s(w,{startX:c(e).x,startY:c(e).y,transX:g(i),transY:m(i)}),t.dragging=!0,document.addEventListener(o,b),document.addEventListener(n,x))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{const{zoomRatio:i}=r;if(t.wheeling)return;let a;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?a=e.deltaY>0?-1:1:e.wheelDelta?a=e.wheelDelta/120:e.detail&&(a=e.detail>0?-1:1),t.zoom(a*i,c(e))}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,image:e,options:i}=this;t.classList.add("zoomist-container"),t.append(e)}}return Object.assign(p.prototype,u),p}));
