/*!
 * zoomist.js v1.0.0
 * https://github.com/cotton123236/zoomist#readme
 *
 * Copyright 2021-present Wilson Wu
 * Released under the MIT license
 *
 * Date: 2021-11-07T14:37:30.762Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoomist=e()}(this,(function(){"use strict";var t={fill:"cover",src:"data-zoomist-src",draggable:!0,bounds:!0,zoomRatio:.1,maxRatio:!1,wheel:!0};const e={direction:"horizontal"},i="zoomist",a=!(!("undefined"!=typeof window&&void 0!==window.document)||!window.document.documentElement)&&"ontouchstart"in window.document.documentElement,o=a?"touchstart":"mousedown",n=a?"touchmove":"mousemove",s=a?"touchend touchcancel":"mouseup",r=(t,e)=>{t||(t={});for(const[i,a]of Object.entries(e))t[i]=a},d=t=>Object.assign({},t),l=t=>"number"==typeof t&&!isNaN(t),h=t=>null!==c(t),c=t=>t instanceof HTMLElement?t:document.querySelector(t),m=(t,e)=>{for(const[i,a]of Object.entries(e))t.style[i]=l(a)?`${a}px`:a},g=t=>({x:a?t.touches[0].pageX:t.pageX,y:a?t.touches[0].pageY:t.pageY,clientX:a?t.touches[0].clientX:t.clientX,clientY:a?t.touches[0].clientY:t.clientY}),u=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[12]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[4]):0)},p=t=>{const e=getComputedStyle(t).transform;let i=e.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[13]):(i=e.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[5]):0)},f=(t,e,i)=>Math.min(Math.max(t,e),i);var w={getContainerData(){return d(this.data.containerData)},getImageData(){return d(this.data.imageData)},zoom(t,e){const{image:i,data:a,options:o,ratio:n}=this;if(o.bounds&&1===n&&t<0)return;if(o.maxRatio&&n===o.maxRatio&&t>0)return;const{originImageData:s}=a,d=this.getContainerData(),l=this.getImageData(),h=i.getBoundingClientRect(),c=n*(t+1),g=o.bounds&&c<1?1:o.maxRatio&&c>o.maxRatio?o.maxRatio:c,w=g/n-1,b=s.width*g,v=s.height*g,x=(d.width-b)/2,y=(d.height-v)/2,D=e?(l.width/2-e.clientX+h.left)*w+u(i):0,Y=e?(l.height/2-e.clientY+h.top)*w+p(i):0,z=o.bounds?f(D,x,-x):D,X=o.bounds?f(Y,y,-y):Y,R={width:b,height:v,left:x,top:y};r(a.imageData,R),m(i,Object.assign({},R,{transform:`translate(${z}px, ${X}px)`})),this.ratio=g}};var b={createSlider(){const{element:t,options:i}=this;i.slider=Object.assign(e,i.slider);const{slider:a}=i,o=a.el&&h(a.el)?c(a.el):document.createElement("div");a.el&&h(a.el)||o.classList.add("zoomist-slider"),o.innerHTML='\n  <div class="zoomist-slider-main">\n    <span class="zoomist-slider-bar"></span>\n    <span class="zoomist-slider-button"></span>\n  </div>\n',a.el=o,a.sliderMain=o.querySelector(".zoomist-slider-main"),a.sliderBar=o.querySelector(".zoomist-slider-bar"),a.sliderButton=o.querySelector(".zoomist-slider-button"),o.addEventListener("click",(function(t){console.log("test"),t.stopPropagation()})),t.append(o),console.log(o)}};class v{constructor(e,i={}){if(!e)throw new Error("The first argument is required.");if(!h(e))throw new Error("This element is not exist.");this.element=c(e),this.options=Object.assign({},t,(t=>{if(!(t=>"object"==typeof t&&null!==t)(t))return!1;try{const{constructor:e}=t,{prototype:i}=e,{hasOwnProperty:a}=Object.prototype;return e&&i&&a.call(i,"isPrototypeOf")}catch(t){return!1}})(i)&&i),this.init()}init(){const{element:e,options:a}=this;if(e[i])return;e[i]=this;const o=a.src="string"==typeof(n=a.src)&&""!==n?a.src:t.src;var n;const s=e.getAttribute(o);e.removeAttribute(o),this.create(s)}create(t){if(!t)return;const{element:e}=this,{offsetWidth:i,offsetHeight:a}=e;this.url=t,this.data={},this.data.containerData={width:i,height:a,aspectRatio:i/a},this.ratio=1,this.mount()}mount(){if(this.mounted)return;const{options:t,data:e,url:i}=this,{containerData:a}=e,{fill:d,maxRatio:h}=t;this.wrapper&&this.wrapper.remove();const c=document.createElement("div");c.classList.add("zoomist-wrapper");const f=document.createElement("img");f.classList.add("zoomist-image"),f.src=i,f.onload=()=>{this.wrapper=c,this.image=f;const{naturalWidth:e,naturalHeight:i}=f,w=e/i;let b;"cover"!==d&&"contain"!==d&&"none"!==d&&(t.fill="cover"),"cover"===t.fill&&(b=a.aspectRatio===w?"both":a.aspectRatio>w?"width":"height"),"contain"===t.fill&&(b=a.aspectRatio===w?"both":a.aspectRatio>w?"height":"width");const v="none"===t.fill?e:"both"===b||"width"===b?a.width:a.height*w,x="none"===t.fill?i:"both"===b||"height"===b?a.height:a.width/w,y=(a.width-v)/2,D=(a.height-x)/2;this.data.originImageData={naturalWidth:e,naturalHeight:i,aspectRatio:w,width:v,height:x,left:y,top:D},this.data.imageData=Object.assign({},this.data.originImageData),m(f,{width:v,height:x,left:y,top:D}),(!l(h)||h<=1)&&!1!==h&&(t.maxRatio=!1),(t=>{const{element:e,wrapper:i,image:a,options:d,data:l}=t,{containerData:h,imageData:c,originImageData:f}=l;window.addEventListener("resize",(()=>{const i=e.offsetWidth/h.width,o=e.offsetHeight/h.height,n=f.width*i,s=f.height*o,d=f.left*i,l=f.top*o,g=c.width*i,w=c.height*o,b=c.left*i,v=c.top*o,x=u(a)*i,y=p(a)*o;r(h,{width:e.offsetWidth,height:e.offsetHeight}),r(f,{width:n,height:s,left:d,top:l}),r(c,{width:g,height:w,left:b,top:v}),m(t.image,{width:g,height:w,left:b,top:v,transform:`translate(${x}px, ${y}px)`})})),t.dragging=!1,t.data.dragData={startX:0,startY:0,transX:0,transY:0},"contain"===d.fill&&d.bounds&&(d.bounds=!1);const{dragData:w}=l,b=e=>{if(!t.dragging)return;const i=g(e).x,o=g(e).y;if(d.bounds){const t=w.startX-(w.transX-c.left),e=w.startX-(w.transX+c.left),a=w.startY-(w.transY-c.top),n=w.startY-(w.transY+c.top);i<t&&(w.startX+=i-t),i>e&&(w.startX+=i-e),o<a&&(w.startY+=o-a),o>n&&(w.startY+=o-n)}const n=i-w.startX+w.transX,s=o-w.startY+w.transY;a.style.transform=`translate(${n}px, ${s}px)`},v=()=>{t.dragging=!1,document.removeEventListener(n,b),document.removeEventListener(s,v)};i.addEventListener(o,(e=>{d.draggable&&1===e.which&&(r(w,{startX:g(e).x,startY:g(e).y,transX:u(a),transY:p(a)}),t.dragging=!0,document.addEventListener(n,b),document.addEventListener(s,v))})),t.wheeling=!1,e.addEventListener("wheel",(e=>{const{zoomRatio:i}=d;if(t.wheeling)return;let a;t.wheeling=!0,setTimeout((()=>{t.wheeling=!1}),30),e.deltaY?a=e.deltaY>0?-1:1:e.wheelDelta?a=e.wheelDelta/120:e.detail&&(a=e.detail>0?-1:1),t.zoom(a*i,g(e))}))})(this),this.mounted=!0,this.render()}}render(){const{element:t,wrapper:e,image:i,options:a}=this;t.classList.add("zoomist-container"),e.append(i),t.append(e),a.slider&&this.createSlider()}}return Object.assign(v.prototype,w,b),v}));
