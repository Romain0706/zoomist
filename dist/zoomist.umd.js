(function(E,f){typeof exports=="object"&&typeof module<"u"?module.exports=f():typeof define=="function"&&define.amd?define(f):(E=typeof globalThis<"u"?globalThis:E||self,E.Zoomist=f())})(this,function(){var B,Rt,j,Xt,k,zt,G,Dt,P,yt,F,Lt,q,At,K,It,J,$t,Q,xt,tt,Mt,et,Ct;"use strict";var he=Object.defineProperty;var de=(E,f,S)=>f in E?he(E,f,{enumerable:!0,configurable:!0,writable:!0,value:S}):E[f]=S;var R=(E,f,S)=>(de(E,typeof f!="symbol"?f+"":f,S),S),ue=(E,f,S)=>{if(!f.has(E))throw TypeError("Cannot "+S)};var b=(E,f,S)=>{if(f.has(E))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(E):f.set(E,S)};var O=(E,f,S)=>(ue(E,f,"access private method"),S);const E="",f=n=>document.contains(N(n)),S=n=>{if(!n)return!1;try{const{constructor:t}=n,{prototype:s}=t,{hasOwnProperty:e}=Object.prototype;return t&&s&&e.call(s,"isPrototypeOf")}catch{return!1}},ut=n=>typeof n=="function",C=n=>!isNaN(Number(n)),st=n=>n==null,N=n=>n instanceof HTMLElement?n:document.querySelector(n),X=n=>{const t=n instanceof TouchEvent?n.touches[0]:n;return{clientX:t.clientX,clientY:t.clientY}},Z=n=>({clientX:[...n].map(t=>t.clientX).reduce((t,s)=>t+s)/n.length,clientY:[...n].map(t=>t.clientY).reduce((t,s)=>t+s)/n.length}),z=n=>{const{width:t,height:s,top:e,left:i,bottom:c}=n.getBoundingClientRect();return{width:t,height:s,top:e,left:i,bottom:c}},mt=n=>n.length>=2?Math.hypot(n[0].clientX-n[1].clientX,n[0].clientY-n[1].clientY):0,A=(n,t)=>{for(const[s,e]of Object.entries(t))typeof e=="string"&&n.style.setProperty(s,e)},I=(n,t)=>{for(const[s,e]of Object.entries(t))n.setAttribute(s,e)},v=(n,t)=>{for(const[s,e]of Object.entries(t))n[s]=e},D=(n,t,s)=>Math.min(Math.max(n,t),s),L=n=>{const t=+(Math.round(+(n+"e+2"))+"e-2");return isNaN(t)?0:t},ft=n=>{throw new Error(n)},nt=n=>console.warn(n),$=(n="div",t,s,e)=>{const i=document.createElement(n);return t&&i.classList.add(...t.split(" ")),s&&I(i,s),e&&(i.innerHTML=e),i},p="zoomist",gt=`${p}-wrapper`,it=`${p}-image`,x=`${p}-slider`,Nt=`${p}-slider-wrapper`,Zt=`${p}-slider-bar`,Ht=`${p}-slider-button`,H=`${p}-zoomer`,Wt=`${p}-zoomer-button`,ot=`${p}-zoomer-icon`,rt=`${p}-zoomer-in`,at=`${p}-zoomer-out`,lt=`${p}-zoomer-reset`,Vt=`${p}-zoomer-disabled`,Ut={tabindex:"0",role:"slider","aria-label":"slider for zoomist","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0","aria-disabled":"false"},ct={tabindex:"0",role:"button","aria-disabled":"false"},Bt={...ct,"aria-label":"button for zoom in zoomist"},jt={...ct,"aria-label":"button for zoom out zoomist"},kt={...ct,"aria-label":"button for reset zoomist scale"},y=!!(typeof window<"u"&&typeof window.document<"u"&&"ontouchstart"in window),Gt=y?"touchstart":"mousedown",W=y?"touchmove":"mousemove",V=y?"touchend":"mouseup",Pt="wheel",Ft=["left","right","center"],qt=["top","bottom","center"],_t="--scale",pt="--translate-x",Et="--translate-y",Kt="--value",St={draggable:!0,wheelable:!0,pinchable:!0,bounds:!1,zoomRatio:.1,maxScale:10,minScale:1,initScale:null},Jt={el:null,direction:"horizontal"},Qt={el:`.${x}`},te={el:null,inEl:null,outEl:null,resetEl:null,disabledClass:Vt},ee={el:`.${H}`,inEl:`.${rt}`,outEl:`.${at}`,resetEl:`.${lt}`},se={ready:null,zoom:null,wheel:null,dragStart:null,drag:null,dragEnd:null,pinchStart:null,pinch:null,pinchEnd:null,slideStart:null,slide:null,slideEnd:null,resize:null,reset:null,beforeDestroy:null,destroy:null,beforeUpdate:null,update:null},ne={slider:null,zoomer:null},ie=`
<svg viewBox="0 0 12 12" class="${ot}">
  <polygon points="12,5.5 6.5,5.5 6.5,0 5.5,0 5.5,5.5 0,5.5 0,6.5 5.5,6.5 5.5,12 6.5,12 6.5,6.5 12,6.5 "/>
</svg>
`,oe=`
<svg viewBox="0 0 12 12" class="${ot}">
  <rect y="5.5" width="12" height="1"/>
</svg>
`,re=`
<svg viewBox="0 0 12 12" class="${ot}">
  <path d="m7.45,1.27l.35-.22c.26-.17.34-.52.17-.78-.17-.27-.52-.34-.78-.17l-1.54.99-.19.13-.11.46,1.12,1.75c.11.17.29.26.48.26.1,0,.21-.03.31-.09.26-.17.34-.52.17-.78l-.29-.46c1.85.5,3.22,2.17,3.22,4.18,0,2.39-1.95,4.34-4.34,4.34S1.66,8.92,1.66,6.52c0-1.15.44-2.23,1.25-3.05.22-.22.22-.58,0-.8-.22-.22-.58-.22-.8,0-1.02,1.03-1.58,2.4-1.58,3.85,0,3.02,2.46,5.48,5.48,5.48s5.48-2.46,5.48-5.48c0-2.51-1.71-4.62-4.02-5.26Z"/>
</svg>
`,ae={on(n,t){if(!t||!ut(t))return this;const{__events__:s}=this;return n.split(" ").forEach(e=>{const i=e;s[i]||(s[i]=[]),s[i].push(t)}),this},emit(n,...t){const{__events__:s}=this;return s[n]?(s[n].forEach(e=>{ut(e)&&e.apply(this,t)}),this):this},zoom(n,t){const{scale:s}=this.transform,e=this.useFixedRatio(L(s*(n+1)));return s===e?this:(this.zoomTo(e,t),this)},zoomTo(n,t=!0){const{image:s,transform:{scale:e,translateX:i,translateY:c},options:{bounds:l}}=this;if(n=this.useFixedRatio(n),n===e)return this;if(this.transform.scale=n,this.emit("zoom",this,this.transform.scale),!t)return this;t=typeof t=="boolean"?this.getContainerCenterClient():t;const{clientX:a,clientY:r}=t,{top:o,left:m,width:g,height:u}=z(s),{width:h,height:d}=this.getImageDiff(),_=n/e-1,T=(g/2-a+m)*_+i,w=(u/2-r+o)*_+c,Y=l?D(T,h,-h):T,M=l?D(w,d,-d):w;return v(this.transform,{translateX:Y,translateY:M}),this},move(n){const{options:{bounds:t},transform:{translateX:s,translateY:e}}=this,{x:i,y:c}=n,{width:l,height:a}=this.getImageDiff();if(C(i)){const r=s+i,o=t?D(r,l,-l):r;this.transform.translateX=o}if(C(c)){const r=e+c,o=t?D(r,a,-a):r;this.transform.translateY=o}return this},moveTo(n){const{options:{bounds:t}}=this,{x:s,y:e}=n,{width:i,height:c}=this.getImageDiff();if(C(s)){const l=Number(s),a=t?D(l,i,-i):l;this.transform.translateX=a}if(Ft.some(l=>l===s)){const a={left:-i,right:i,center:0}[s];this.transform.translateX=a}if(C(e)){const l=Number(e),a=t?D(l,c,-c):l;this.transform.translateY=a}if(qt.some(l=>l===e)){const a={top:-c,bottom:c,center:0}[e];this.transform.translateY=a}return this},slideTo(n){const{options:{minScale:t,maxScale:s}}=this,e=(s-t)*n/100+t;return this.zoomTo(e),this},reset(){const{options:{initScale:n}}=this;return v(this.transform,{scale:n,translateX:0,translateY:0}),this.emit("reset",this),this},destroy(n=!1){const{element:t,image:s,controller:e}=this;return this.mounted&&(this.emit("beforeDestroy",this),e.abort(),this.destroyModules(),n&&s&&(this.reset(),s.removeAttribute("style")),t[p]=null,this.mounted=!1,this.emit("destroy",this)),null},update(n){const{element:t,controller:s}=this;return this.emit("beforeUpdate",this),t[p]=null,this.mounted=!1,s.abort(),this.destroyModules(),n&&(this.options=Object.assign({},St,S(n)&&n)),this.init(),this.emit("update",this),this},getImageData(){return{...this.data.imageData}},getContainerData(){return{...this.data.containerData}},getSliderValue(){const{__modules__:{slider:n}}=this;return n&&n.value?n.value:null},getImageDiff(){const{width:n,height:t}=this.getContainerData(),{width:s,height:e}=this.getImageData();return{width:(n-s)/2,height:(t-e)/2}},getContainerCenterClient(){const{element:n}=this,{top:t,left:s,width:e,height:i}=z(n);return{clientX:s+e/2,clientY:t+i/2}},getScaleRatio(){const{transform:{scale:n},options:{minScale:t,maxScale:s}}=this;return(n-t)/(s-t)},useFixedRatio(n){const{options:{minScale:t,maxScale:s}}=this;return D(n,t,s)}},{defineProperty:U}=Object;class vt{constructor(t,s){b(this,B);b(this,j);b(this,k);b(this,G);b(this,P);b(this,F);b(this,q);b(this,K);b(this,J);b(this,Q);b(this,tt);b(this,et);R(this,"element");R(this,"options");R(this,"wrapper");R(this,"image");R(this,"mounted");R(this,"data");R(this,"transform");R(this,"states");R(this,"controller");R(this,"__events__");R(this,"__modules__");t||ft("The first argument is required."),f(t)||ft(`Element ${t} is not exist.`),this.element=N(t),this.options=Object.assign({},St,S(s)&&s),this.init()}init(){const{element:t}=this,{options:{bounds:s,minScale:e,maxScale:i,initScale:c}}=this;if(t[p])return;t[p]=this;const l=t.querySelector(`.${gt}`),a=t.querySelector(`.${it}`);if(!l)return nt(`${p} needs a ".${gt}" element.`);if(!a)return nt(`${p} needs a ".${it}" element.`);this.options.minScale=s&&e<1?1:e,this.options.maxScale=Math.max(i,e),this.options.initScale=D(c||e,e,i),this.wrapper=l,this.image=a,O(this,B,Rt).call(this)}destroyModules(){const{slider:t,zoomer:s}=this.__modules__;t&&this.destroySlider(),s&&this.destroyZoomer()}destroySlider(){var c,l;const{__modules__:{slider:t}}=this;if(!t||!t.mounted)return;const{options:{el:s},controller:e}=t;s===`.${x}`?(c=t.sliderEl)==null||c.remove():(l=t.sliderTrack)==null||l.remove(),e==null||e.abort(),t.mounted=!1}destroyZoomer(){const{__modules__:{zoomer:t}}=this;if(!t||!t.mounted)return;const{options:{el:s,inEl:e,outEl:i,resetEl:c},controller:l,zoomerEl:a,zoomerInEl:r,zoomerOutEl:o,zoomerResetEl:m}=t,g=(u,h,d)=>{u===`.${h}`&&(d==null||d.remove())};[{target:s,className:H,el:a},{target:e,className:rt,el:r},{target:i,className:at,el:o},{target:c,className:lt,el:m}].forEach(u=>g(u.target,u.className,u.el)),l==null||l.abort(),t.mounted=!1}}return B=new WeakSet,Rt=function(){const{element:t,image:s,options:e}=this,{draggable:i,pinchable:c}=e,{offsetWidth:l,offsetHeight:a}=t,{offsetWidth:r,offsetHeight:o}=s,{width:m,height:g}=z(s);if(!r||!o)return nt(`The width or height of ${it} should not be 0.`);if(this.transform={scale:0,translateX:0,translateY:0},this.data={imageData:{originWidth:r,originHeight:o,width:m,height:g},containerData:{width:l,height:a}},y&&(i||c)&&(this.data.touchData={hypot:0,startX:0,startY:0,prevX:0,prevY:0,imageTop:0,imageLeft:0,widthDiff:0,heightDiff:0}),!y&&i&&(this.data.dragData={startX:0,startY:0}),this.__events__={...se},e.on)for(const[u,h]of Object.entries(e.on))this.__events__[u]=[h];if(this.__modules__={...ne},e.slider){const u=e.slider===!0?Qt:e.slider;this.__modules__.slider={options:Object.assign({},Jt,u)}}if(e.zoomer){const u=e.zoomer===!0?ee:e.zoomer;this.__modules__.zoomer={options:Object.assign({},te,u)}}this.controller=new AbortController,O(this,j,Xt).call(this)},j=new WeakSet,Xt=function(){if(this.mounted)return;const{image:t,options:{minScale:s,maxScale:e,initScale:i},__modules__:{slider:c,zoomer:l}}=this,a=this;A(t,{transform:`
        translate(var(${pt}, 0px), var(${Et}, 0px))
        scale(var(${_t}, 0))`}),U(this.transform,"scale",{get(){return a.transform.__scale__},set(r){const o=a.useFixedRatio(r);if(!(st(o)||a.transform.__scale__===o)){if(a.transform.__scale__=o,A(t,{[_t]:o.toString()}),v(a.data.imageData,{width:z(t).width,height:z(t).height}),c){const m=Math.round(a.getScaleRatio()*100);c.value=m}if(l&&l.options.disabledClass){const{zoomerInEl:m,zoomerOutEl:g,zoomerResetEl:u,options:{disabledClass:h}}=l;m&&(m.classList[o===e?"add":"remove"](h),I(m,{"aria-disabled":o===e?"true":"false"})),g&&(g.classList[o===s?"add":"remove"](h),I(g,{"aria-disabled":o===s?"true":"false"})),u&&(u.classList[o===i?"add":"remove"](h),I(u,{"aria-disabled":o===i?"true":"false"}))}}}}),U(this.transform,"translateX",{get(){return a.transform.__translateX__},set(r){const o=L(r);st(o)||a.transform.__translateX__===o||(a.transform.__translateX__=o,A(t,{[pt]:`${o}px`}))}}),U(this.transform,"translateY",{get(){return a.transform.__translateY__},set(r){const o=L(r);st(o)||a.transform.__translateY__===o||(a.transform.__translateY__=o,A(t,{[Et]:`${o}px`}))}}),O(this,k,zt).call(this),O(this,K,It).call(this),v(this.transform,{scale:i,translateX:0,translateY:0}),this.mounted=!0,this.emit("ready",this)},k=new WeakSet,zt=function(){const{wrapper:t,options:s,controller:{signal:e}}=this,{draggable:i,pinchable:c,wheelable:l}=s;if(this.states={},l){this.states.wheeling=!1;const a=r=>O(this,G,Dt).call(this,r);t.addEventListener(Pt,a,{signal:e})}if(y&&(i||c)){i&&(this.states.dragging=!1),c&&(this.states.pinching=!1);const a=r=>O(this,F,Lt).call(this,r);t.addEventListener("touchstart",a,{signal:e})}if(!y&&i){this.states.dragging=!1;const a=r=>O(this,P,yt).call(this,r);t.addEventListener("mousedown",a,{signal:e})}O(this,q,At).call(this)},G=new WeakSet,Dt=function(t){const{options:s}=this,{zoomRatio:e}=s;if(t.preventDefault(),this.states.wheeling)return;this.states.wheeling=!0,setTimeout(()=>{this.states.wheeling=!1},30);const i=(t.deltaY||t.detail)>0?-1:1;this.zoom(i*e,X(t)),this.emit("wheel",this,this.transform.scale,t)},P=new WeakSet,yt=function(t){const{data:s,transform:e}=this,{dragData:i,imageData:c}=s;if(!i||!c)return;const l=o=>{o&&o.button!==0||(v(i,{startX:X(o).clientX,startY:X(o).clientY}),this.states.dragging=!0,this.emit("dragStart",this,{x:e.translateX,y:e.translateY},o),document.addEventListener(W,a),document.addEventListener(V,r))},a=o=>{if(o.touches||!this.states.dragging)return;const m=X(o).clientX,g=X(o).clientY,u=m-i.startX+e.translateX,h=g-i.startY+e.translateY;this.moveTo({x:u,y:h}),v(i,{startX:X(o).clientX,startY:X(o).clientY}),this.emit("drag",this,{x:u,y:h},o)},r=o=>{o.touches||(this.states.dragging=!1,this.emit("dragEnd",this,{x:e.translateX,y:e.translateY},o),document.removeEventListener(W,a),document.removeEventListener(V,r))};l(t)},F=new WeakSet,Lt=function(t){const{data:s,transform:e,options:{maxScale:i,minScale:c,draggable:l,pinchable:a}}=this,{touchData:r,imageData:o}=s;if(!r||!o)return;const m=h=>{const d=h.touches;if(!d)return;const{top:_,left:T}=z(this.image),{width:w,height:Y}=this.getImageDiff();v(r,{hypot:mt(d),startX:Z(d).clientX,startY:Z(d).clientY,prevX:0,prevY:0,imageTop:_,imageLeft:T,widthDiff:w,heightDiff:Y}),l&&(this.states.dragging=!0,this.emit("dragStart",this,{x:e.translateX,y:e.translateY},h)),a&&d.length===2&&(this.states.pinching=!0,this.emit("pinchStart",this,e.scale,h)),document.addEventListener("touchmove",g),document.addEventListener("touchend",u)},g=h=>{const d=h.touches;if(!d)return;const{states:{dragging:_,pinching:T}}=this,{top:w,left:Y}=z(this.image),{width:M,height:Tt}=this.getImageDiff(),ht=mt(d),bt=ht?ht/r.hypot:1,dt=this.useFixedRatio(bt*e.scale),Ot=Z(d).clientX+r.prevX,wt=Z(d).clientY+r.prevY;if(T&&d.length===2&&this.zoomTo(dt,!1),_){const Yt=dt!==i&&dt!==c&&a?bt:1,le=L(Ot-r.imageLeft-(M-r.widthDiff)-(r.startX-r.imageLeft)*Yt+e.translateX),ce=L(wt-r.imageTop-(Tt-r.heightDiff)-(r.startY-r.imageTop)*Yt+e.translateY);this.moveTo({x:le,y:ce})}v(r,{hypot:ht,startX:Ot,startY:wt,imageTop:w,imageLeft:Y,widthDiff:M,heightDiff:Tt}),T&&d.length===2&&this.emit("pinch",this,e.scale,h),_&&this.emit("drag",this,{x:e.translateX,y:e.translateY},h)},u=h=>{const d=h.touches;if(!d)return;const{states:{dragging:_,pinching:T}}=this;if(_&&!d.length&&(this.states.dragging=!1,this.emit("dragEnd",this,{x:e.translateX,y:e.translateY},h)),T&&d.length<2&&(this.states.pinching=!1,this.emit("pinchEnd",this,e.scale,h)),_&&d.length===1){const w=X(h).clientX,Y=X(h).clientY;v(r,{prevX:r.startX-w,prevY:r.startY-Y})}d.length||(document.removeEventListener("touchmove",g),document.removeEventListener("touchend",u))};m(t)},q=new WeakSet,At=function(){const{element:t,image:s,transform:e}=this;new ResizeObserver(()=>{const{offsetWidth:c,offsetHeight:l}=t,{width:a,height:r}=this.getContainerData();if(c===a&&l===r)return;const o=e.translateX,m=e.translateY;if(o){const _=c/a*o;this.transform.translateX=_}if(m){const _=l/r*m;this.transform.translateY=_}const{offsetWidth:g,offsetHeight:u}=s,{width:h,height:d}=z(s);v(this.data.containerData,{width:c,height:l}),v(this.data.imageData,{originWidth:g,originHeight:u,width:h,height:d}),this.emit("resize",this)}).observe(t)},K=new WeakSet,It=function(){const{slider:t,zoomer:s}=this.__modules__;t&&O(this,J,$t).call(this),s&&O(this,tt,Mt).call(this)},J=new WeakSet,$t=function(){const{element:t,__modules__:{slider:s}}=this;if(!s||s.mounted)return;const{options:{el:e,direction:i}}=s,c=e===`.${x}`;if(!e||!c&&!f(e))return;const l=c?$("div",x):N(e),a=$("div",Nt),r=$("span",Zt),o=$("span",Ht,{...Ut,"aria-orientation":i});l.classList.add(`${x}-${i}`),U(s,"value",{get(){return s.__value__},set(m){s.__value__!==m&&(s.__value__=m,A(l,{[Kt]:m.toString()}),I(o,{"aria-valuenow":m.toString()}))}}),v(s,{value:this.getScaleRatio()*100,controller:new AbortController,sliding:!1,sliderEl:l,sliderTrack:a,sliderButton:o}),O(this,Q,xt).call(this),a.append(r,o),l.append(a),c&&t.append(l),s.mounted=!0},Q=new WeakSet,xt=function(){const{options:{minScale:t,maxScale:s},__modules__:{slider:e}}=this;if(!e)return;const{options:{direction:i},controller:c,sliderEl:l,sliderTrack:a}=e;if(!l||!a)return;const r=i==="vertical",o=h=>{const d=z(a),_=d[r?"height":"width"],T=d[r?"bottom":"left"],w=X(h)[r?"clientY":"clientX"],Y=L(D((w-T)*(r?-1:1)/_,0,1));return(s-t)*Y+t},m=h=>{if(h instanceof MouseEvent&&h.button!==0)return;e.sliding=!0;const d=o(h);this.zoomTo(d),this.emit("slideStart",this,this.getSliderValue(),h),document.addEventListener(W,g),document.addEventListener(V,u)},g=h=>{if(!e.sliding)return;const d=o(h);this.zoomTo(d),this.emit("slide",this,this.getSliderValue(),h)},u=h=>{this.emit("slideEnd",this,this.getSliderValue(),h),e.sliding=!1,document.removeEventListener(W,g),document.removeEventListener(V,u)};l.addEventListener(Gt,m,{signal:c==null?void 0:c.signal})},tt=new WeakSet,Mt=function(){const{element:t,__modules__:{zoomer:s}}=this;if(!s||s.mounted)return;const{options:{el:e,inEl:i,outEl:c,resetEl:l}}=s,a=[i,c,l],r=(h,d,_,T,w)=>{const Y=h===`.${_}`;return!h||!Y&&!f(h)?null:(_=a.includes(h)?`${_} ${Wt}`:_,Y?$(d,_,T,w):N(h))},o=r(e,"div",H),m=r(i,"button",rt,Bt,ie),g=r(c,"button",at,jt,oe),u=r(l,"button",lt,kt,re);v(s,{controller:new AbortController,zoomerEl:o,zoomerInEl:m,zoomerOutEl:g,zoomerResetEl:u}),o&&(m&&o.append(m),g&&o.append(g),u&&o.append(u),e===`.${H}`&&t.append(o)),O(this,et,Ct).call(this),s.mounted=!0},et=new WeakSet,Ct=function(){const{options:{zoomRatio:t},__modules__:{zoomer:s}}=this,e=this;if(!s)return;const{controller:i,zoomerInEl:c,zoomerOutEl:l,zoomerResetEl:a}=s;c&&c.addEventListener("click",()=>{e.zoom(t)},{signal:i==null?void 0:i.signal}),l&&l.addEventListener("click",()=>{e.zoom(-t)},{signal:i==null?void 0:i.signal}),a&&a.addEventListener("click",()=>{e.reset()},{signal:i==null?void 0:i.signal})},Object.assign(vt.prototype,ae),vt});
